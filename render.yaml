services:
  - type: web
    name: doterra-backend
    runtime: python
    buildCommand: >
      pip install uv &&
      uv pip install -r requirements.txt
    startCommand: >
      uvicorn backend.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.12
      - key: QDRANT_HOST
        fromService:
          name: qdrant-service
          type: pserv
          property: hostport
      - key: QDRANT_PORT
        value: 6333
      - key: QDRANT_COLLECTION
        value: essential_oils
      - key: MODEL_NAME
        value: jinaai/jina-embeddings-v2-base-de
      - key: ALLOWED_ORIGINS
        sync: false
      - key: PERPLEXITY_API_KEY
        sync: false
      - key: LANGFUSE_PUBLIC_KEY
        sync: false
      - key: LANGFUSE_SECRET_KEY
        sync: false
      - key: LANGFUSE_HOST
        value: https://cloud.langfuse.com

  - type: pserv
    name: qdrant-service
    image:
      url: docker.io/qdrant/qdrant:latest
    startCommand: "/qdrant/entrypoint.sh"
    plan: starter
    disk:
      name: qdrant-data
      mountPath: /qdrant/storage
      sizeGB: 10
    envVars:
      - key: QDRANT_API_KEY
        sync: false
