# Plan: Food Discovery Style App for Essential Oils

## Goal
Host a React application locally via Docker (and potentially GitHub Pages later) that allows users to discover doTERRA essential oils. The app will be inspired by `qdrant/demo-food-discovery` but will use `serialized_text` embeddings (generated by `jinaai/jina-embeddings-v4`) for search and recommendation, and display the oils using `product_image_url`.

## Architecture

### Local Docker Setup
The application will consist of three services orchestrated by Docker Compose:

1.  **Qdrant Service**:
    *   Image: `qdrant/qdrant:latest`
    *   Role: Stores vectors and payloads. Performs vector search and recommendations.
    *   Persistence: Docker volume `qdrant_data`.

2.  **Backend API (Python/FastAPI)**:
    *   Role:
        *   Host the embedding model (`jinaai/jina-embeddings-v4`).
        *   Expose endpoints for `/search` (text -> vector) and `/recommend` (positive/negative IDs -> new vectors).
        *   Proxy requests to Qdrant.
    *   Reason for Backend: The specific model (`jina-v4`) is large (~6GB) and requires Python `trust_remote_code=True`, making it unsuitable for direct browser execution (WASM) or standard static hosting without a dedicated backend.

3.  **Frontend (React + Vite)**:
    *   Role: User Interface.
    *   Tech Stack: React, TailwindCSS, Framer Motion (for animations), Lucide React (icons).
    *   Features:
        *   **Discovery Mode**: Show cards; user clicks "Like" or "Dislike"; app fetches recommendation based on preference.
        *   **Search Mode**: Text input for semantic search ("oils for sleep").
        *   **Premium Aesthetics**: Glassmorphism, smooth transitions.

## Implementation Steps

### Phase 1: Infrastructure & Backend

1.  **Project Structure Setup**:
    *   Create directories: `frontend/`, `backend/`, `nginx/` (optional, for prod, but direct port mapping is fine for dev).
    
2.  **Qdrant Setup**:
    *   Define `docker-compose.yaml` with `qdrant` service.
    *   Expose port `6333`.

3.  **Backend Service**:
    *   Create `backend/main.py` using FastAPI.
    *   Implement `startup` event to load `SentenceTransformer('jinaai/jina-embeddings-v4')`.
    *   Implement `POST /search`: Accepts text, generates embedding, queries Qdrant.
    *   Implement `POST /recommend`: Accepts list of liked/disliked IDs, uses Qdrant's Recommendation API (using stored vectors).
    *   Create `backend/Dockerfile` ensuring `torch` and `sentence-transformers` are installed.

4.  **Data Ingestion**:
    *   Modify `generate_and_upload_embeddings.py` (or create `ingest_to_local_qdrant.py`) to upload not to `:memory:`, but to `localhost:6333` (or the qdrant service name if running inside docker network).
    *   Run this script purely locally (outside Docker) once Qdrant is up to populate the DB.

### Phase 2: Frontend Development

1.  **Scaffold App**:
    *   Initialize Vite app: `npm create vite@latest frontend -- --template react` (or `react-ts`).
    *   Install TailwindCSS.

2.  **Components**:
    *   **OilCard**: Displays `product_image_url`, title, and action buttons. High-quality UI.
    *   **Swipe/Grid View**: Layout for discovery.
    *   **SearchBar**: For explicit queries.

3.  **Integration**:
    *   Connect to Backend API using `axios`.
    *   State management for "Liked" and "Disliked" items used for recommendations.

4.  **Dockerize Frontend**:
    *   Create `frontend/Dockerfile` (Node base, build step, serve with simple server or just `npm run dev` for local dev).

### Phase 3: Future Migration to GitHub Pages

To move to GitHub Pages (Static Hosting):
*   **Challenge**: GitHub Pages cannot host the Python backend or the 6GB embedding model.
*   **Option A (Hosted Backend)**: Deploy the Backend (Docker) to a cloud provider (Render, Railway, AWS, or Hugging Face Spaces). Point the GitHub Pages frontend to this URL.
*   **Option B (Serverless/Client-side)**:
    *   Switch to a smaller, browser-compatible model (e.g., `Xenova/all-MiniLM-L6-v2` via `transformers.js`).
    *   **Implication**: You would need to re-generate all embeddings in Qdrant with this new model.
    *   Use Qdrant Cloud (managed service) instead of local Docker Qdrant.
    *   The app becomes purely static (JS only), generating embeddings in the browser and querying Qdrant Cloud directly.

## Action Plan checklist for User

- [x] Create `docker-compose.yaml`
- [x] Create `backend` directory and code
- [x] Create `frontend` directory and code
- [x] Update ingestion script
- [x] Spin up Docker
- [x] Ingest Data
- [x] Verify functionality
